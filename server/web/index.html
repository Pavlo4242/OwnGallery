<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Gallery</title>
    <link rel="stylesheet" href="modes.css">
<link rel="stylesheet" href="fullscreen.css">
<link rel="stylesheet" href="controls.css">
    <!-- Keep existing CSS styles in a separate file or inline here (truncated for brevity, keep your original CSS) -->
    <style>
       <link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="modes.css">
<link rel="stylesheet" href="fullscreen.css">
<link rel="stylesheet" href="controls.css">
        body { font-family: sans-serif; margin: 0; background: #0a0a0a; color: #e0e0e0; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- ============ TOP CONTROLS BAR ============ -->
    <div class="mode-selector" id="topControls">
        <button class="mode-btn mode-sorting active" onclick="app.modes.set('sorting')">ğŸ—‚ï¸ Sorting</button>
        <button class="mode-btn mode-comparing" onclick="app.modes.set('comparing')">âš–ï¸ Comparing</button>
        <button class="mode-btn mode-browsing" onclick="app.modes.set('browsing')">ğŸ‘€ Browsing</button>
    </div>

    <div class="controls">
        <!-- Sorting Controls -->
        <div class="controls-group sorting-controls">
            <div class="current-folder" id="currentFolder">ğŸ“ <span id="folderName">Loading...</span></div>
            <div class="file-counter" id="fileCounter">0</div>
        </div>

        <!-- Shared Controls -->
        <div class="controls-group sorting-controls browsing-controls">
            <label>Cols:</label> 
            <input type="range" id="thumbnailWidth" min="150" max="400" value="250">
            <button onclick="app.main.init()">ğŸ”„</button>
        </div>

        <!-- Comparing Controls -->
        <div class="controls-group comparing-controls">
            <span style="color:#FF9800; font-weight:bold;">âš–ï¸ Comparing Mode</span>
            <button onclick="app.modes.loadNewComparison()">ğŸ”„ New Pair</button>
            <button onclick="app.modes.markComparison('keep')">âœ… Keep Both</button>
            <button onclick="app.modes.markComparison('discard')">âŒ Discard Both</button>
        </div>

        <!-- Browsing Controls -->
        <div class="controls-group browsing-controls">
            <button onclick="app.modes.toggleInfo()">â„¹ï¸ Info</button>
            <button onclick="app.gallery.shuffle()">ğŸ”€ Shuffle</button>
        </div>

        <!-- Filter Controls -->
        <div class="controls-group sorting-controls">
            <label>Filter:</label>
            <select id="folderFilter" onchange="app.gallery.filterByFolder()"></select>
        </div>
        
        <div class="controls-group">
            <button onclick="app.utils.quitServer()" class="shutdown">â» Shutdown</button>
        </div>
    </div>

    <!-- ============ CONTENT AREAS ============ -->
    <div id="sortingContent" class="content-area">
        <div class="grid"></div>
    </div>

    <div id="comparingContent" class="content-area" style="display:none;">
        <div class="comparing-pair" id="comparisonPair"></div>
        <div class="comparison-stats">
            Comparisons: <span id="comparisonCount">0</span> | Decisions: <span id="decisionCount">0</span>
        </div>
    </div>

    <div id="browsingContent" class="content-area" style="display:none;">
        <div class="browsing-info-panel" id="browsingInfoPanel" style="display:none;">
            <h4>ğŸ“Š Gallery Info</h4>
            <div>Total: <span id="browseTotalCount">0</span></div>
            <div>Unique Scenes: <span id="browseSceneCount">0</span></div>
        </div>
        <div class="grid" id="browsingGrid"></div>
    </div>

    <!-- ============ OVERLAYS & UTILS ============ -->
    <div id="galleryDir" class="gallery-dir"></div>
    <div class="scroll-progress">Loaded: <span id="loadedCount">0</span> / <span id="totalCount">0</span></div>

    <!-- Fullscreen Overlay -->
    <div id="fullscreenOverlay" class="fullscreen-overlay">
        <span class="top-left-close" onclick="app.fullscreen.close()">&times;</span>
        <div id="fullscreenDir" class="fullscreen-dir"></div>
        <select id="fullscreenFolderSelect" class="fullscreen-folder-select" onchange="app.gallery.jumpToFolder(this.value)"></select>
        
        <span class="close-btn" onclick="app.fullscreen.close()">&times;</span>
        <button class="nav-btn prev-btn" id="prevBtn">â€¹</button>
        <button class="nav-btn next-btn" id="nextBtn">â€º</button>
        
        <div class="fullscreen-content"></div>
        
        <div class="media-info" id="mediaInfo">
            <div class="media-counter"></div>
            <div class="media-filename"></div>
            <div class="media-filetype"></div>
        </div>

        <div class="playback-controls" id="playbackControls">
            <button id="playPauseBtn">â–¶ Play</button>
            <button id="toggleShuffleBtn" onclick="app.utils.toggleSlideshowShuffle()">ğŸ”€ Shuffle: OFF</button>
            <div style="text-align: center;">
                <input type="number" id="advanceTime" min="500" value="3000" style="width: 60px;"> ms
            </div>
            <button onclick="app.fullscreen.close()">â†© Back</button>
        </div>

        <div id="verticalProgress" class="vertical-progress-bar" onclick="app.fullscreen.jumpToProgress(event)">
            <div class="vertical-progress-fill" id="progressFill"></div>
        </div>
    </div>

    <div class="nav-fab-container">
        <div class="nav-fab" onclick="window.scrollTo({top:0, behavior:'smooth'})">âŒ‚</div>
        <div class="nav-fab" onclick="window.scrollBy({top:800, behavior:'smooth'})">â†“</div>
    </div>

    <!-- Dependencies -->
    <script src="masonry.pkgd.min.js"></script>
    <script src="imagesloaded.pkgd.min.js"></script>

    <!-- Application Scripts (Order Matters) -->
    <script src="globals.js"></script>
    <script src="utils.js"></script>
    <script src="media.js"></script>
    <script src="gallery.js"></script>
    <script src="mode.js"></script>
    <script src="fullscreen.js"></script>
    <script src="main.js"></script>
</body>
</html>
