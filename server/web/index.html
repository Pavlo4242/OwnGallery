<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Gallery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ============ TOP CONTROLS BAR ============ -->
    <div class="mode-selector" id="topControls">
        <button class="mode-btn mode-sorting active" onclick="app.modes.set('sorting')">ğŸ—‚ï¸ Sorting</button>
        <button class="mode-btn mode-comparing" onclick="app.modes.set('comparing')">âš–ï¸ Comparing</button>
        <button class="mode-btn mode-browsing" onclick="app.modes.set('browsing')">ğŸ‘€ Browsing</button>
    </div>

    <div class="controls">
        <!-- Sorting Controls -->
        <div class="controls-group sorting-controls">
            <div class="current-folder" id="currentFolder" onclick="app.utils.openExplorer()">
                ğŸ“ <span id="folderName">Loading...</span>
            </div>
            <div class="file-counter" id="fileCounter">0 files</div>
        </div>

        <!-- Navigation Controls -->
        <div class="controls-group sorting-controls">
            <div class="nav-controls">
                <button id="navBackBtn" onclick="app.gallery.navigateHistory(-1)" disabled>â—„</button>
                <button id="navForwardBtn" onclick="app.gallery.navigateHistory(1)" disabled>â–º</button>
            </div>
        </div>

        <!-- View Controls -->
        <div class="controls-group sorting-controls browsing-controls">
            <div class="view-mode-toggle">
                <button class="view-mode-btn active" id="gridViewBtn" title="Grid View">âŠ</button>
                <button class="view-mode-btn" id="listViewBtn" title="List View">â˜°</button>
            </div>
        </div>

        <!-- Size Control -->
        <div class="controls-group sorting-controls browsing-controls">
            <label>Size:</label> 
            <input type="range" id="thumbnailWidth" min="150" max="400" value="250" step="10">
        </div>

        <!-- Filter Controls -->
        <div class="controls-group sorting-controls">
            <label>Folder:</label>
            <select id="folderFilter" onchange="app.gallery.filterByFolder()"></select>
        </div>

        <!-- Action Controls -->
        <div class="controls-group sorting-controls browsing-controls">
            <button onclick="app.gallery.shuffle()" title="Shuffle current view">ğŸ”€ Shuffle</button>
            <button onclick="app.main.init()" title="Refresh gallery">ğŸ”„ Refresh</button>
        </div>

        <!-- Feature Toggles -->
        <div class="controls-group sorting-controls browsing-controls">
            <label><input type="checkbox" id="quickPreviewToggle"> Quick Preview</label>
            <button id="filterFavoritesBtn" onclick="app.utils.filterFavorites()" title="Show favorites only">â˜… Favorites</button>
        </div>

        <!-- Multi-Select -->
        <div class="controls-group sorting-controls" id="multiSelectGroup" style="display:none;">
            <button id="multiSelectToggle" onclick="app.utils.toggleMultiSelect()">â˜‘ Multi-Select</button>
            <button id="deleteBtn" class="delete-btn" style="display:none;">ğŸ—‘ Delete (<span id="selectedCount">0</span>)</button>
        </div>

        <!-- Comparing Controls -->
        <div class="controls-group comparing-controls">
            <span style="color:#FF9800; font-weight:bold;">âš–ï¸ Comparing Mode</span>
            <button onclick="app.modes.loadNewComparison()">ğŸ”„ New Pair</button>
            <button onclick="app.modes.markComparison('left')">â† Keep Left</button>
            <button onclick="app.modes.markComparison('right')">Keep Right â†’</button>
            <button onclick="app.modes.markComparison('both')">âœ… Keep Both</button>
            <button onclick="app.modes.markComparison('neither')">âŒ Discard Both</button>
        </div>

        <!-- Browsing Controls -->
        <div class="controls-group browsing-controls">
            <button onclick="app.modes.toggleInfo()">â„¹ï¸ Info</button>
        </div>

        <!-- Shutdown -->
        <div class="controls-group">
            <button onclick="app.utils.quitServer()" class="shutdown" title="Stop server and close">â» Shutdown</button>
        </div>
    </div>

    <!-- ============ CONTENT AREAS ============ -->
    <div id="sortingContent" class="content-area">
        <div class="grid"></div>
    </div>

    <div id="comparingContent" class="content-area" style="display:none;">
        <div class="comparing-pair" id="comparisonPair">
            <div class="loading">Loading comparison pairs...</div>
        </div>
        <div class="comparison-stats">
            <div>Pairs Remaining: <span id="comparisonCount">0</span></div>
            <div>Decisions Made: <span id="decisionCount">0</span></div>
        </div>
    </div>

    <div id="browsingContent" class="content-area" style="display:none;">
        <div class="browsing-info-panel" id="browsingInfoPanel" style="display:none;">
            <h4>ğŸ“Š Gallery Statistics</h4>
            <div>Total Files: <span id="browseTotalCount">0</span></div>
            <div>Images: <span id="browseImageCount">0</span></div>
            <div>Videos: <span id="browseVideoCount">0</span></div>
            <div>Folders: <span id="browseFolderCount">0</span></div>
        </div>
        <div class="grid" id="browsingGrid"></div>
    </div>

    <!-- ============ UI OVERLAYS ============ -->
    <div id="galleryDir" class="gallery-dir"></div>
    <div class="scroll-progress">
        <span id="loadedCount">0</span> / <span id="totalCount">0</span>
    </div>

    <!-- Fullscreen Overlay -->
    <div id="fullscreenOverlay" class="fullscreen-overlay">
        <span class="top-left-close" onclick="app.fullscreen.close()">&times;</span>
        
        <select id="fullscreenFolderSelect" class="fullscreen-folder-select" onchange="app.gallery.jumpToFolder(this.value)">
            <option value="">Jump to Folder...</option>
        </select>
        
        <button class="nav-btn prev-btn" id="prevBtn" onclick="app.fullscreen.navigate(-1)">â€¹</button>
        <button class="nav-btn next-btn" id="nextBtn" onclick="app.fullscreen.navigate(1)">â€º</button>
        
        <div class="fullscreen-content"></div>
        
        <div class="media-info" id="mediaInfo">
            <div class="media-counter"></div>
            <div class="media-filename"></div>
        </div>

        <div class="playback-controls" id="playbackControls">
            <button id="playPauseBtn" onclick="app.fullscreen.toggleSlideshow()">â–¶ Play</button>
            <label style="font-size:12px; color:#ccc;">
                <input type="checkbox" id="slideshowShuffleCheck" onchange="app.utils.toggleSlideshowShuffle()"> Shuffle
            </label>
            <div style="text-align: center; font-size:12px; color:#ccc;">
                <label>Delay (ms):</label>
                <input type="number" id="advanceTime" min="500" max="30000" value="3000" step="500" style="width: 70px;">
            </div>
            <button onclick="app.fullscreen.close()">â†© Exit</button>
        </div>

        <div id="verticalProgress" class="vertical-progress-bar" onclick="app.fullscreen.jumpToProgress(event)">
            <div class="vertical-progress-fill" id="progressFill"></div>
        </div>
    </div>

    <!-- Navigation FABs -->
    <div class="nav-fab-container">
        <div class="nav-fab" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="Scroll to top">âŒ‚</div>
        <div class="nav-fab" onclick="window.scrollBy({top:800, behavior:'smooth'})" title="Scroll down">â†“</div>
    </div>

    
    <!-- Dependencies -->
    <script src="masonry.pkgd.min.js"></script>
    <script src="imagesloaded.pkgd.min.js"></script>
    
    <!-- CDN Fallback (Uncomment if you want internet fallback) -->
    <!--
    <script>
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT') {
                const src = e.target.src;
                if (src.includes('masonry') && typeof Masonry === 'undefined') {
                    const cdn = document.createElement('script');
                    cdn.src = 'https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js';
                    document.head.appendChild(cdn);
                }
                if (src.includes('imagesloaded') && typeof imagesLoaded === 'undefined') {
                    const cdn = document.createElement('script');
                    cdn.src = 'https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js';
                    document.head.appendChild(cdn);
                }
            }
        }, true);
    </script>
    -->
    

    <!-- Application Scripts (Load Order Critical) -->
    <script src="globals.js"></script>
    <script src="utils.js"></script>
    <script src="media.js"></script>
    <script src="gallery.js"></script>
    <script src="mode.js"></script>
    <script src="fullscreen.js"></script>
    <script src="main.js"></script>
</body>
</html>